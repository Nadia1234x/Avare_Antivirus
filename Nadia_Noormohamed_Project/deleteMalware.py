import hash
import database

def delete_virus(username, original_file, filename, signature, DK):
    print 'for the malware file the dk is: ', DK
    with open(filename, "rt") as file:
        file_contents = file.read()
    file.close()

    file_contents = file_contents.replace(signature, "<Removed>")

    with open(filename, 'w') as file:
        file.write(file_contents)
    file.close()

    #Need to update the checksum of the original file after malware is deleted
    checksum_new = hash.generate_file_checksum(filename, DK)
    db = database.initialise_db('root', 'Narnia0102*')
    query = 'UPDATE ' + str(username) + '_file_checksum SET ID = "' + str(original_file) + '", ' +  'checksum = "' + str(checksum_new) + '" WHERE ID = "' + str(original_file) + '" ;'
    database.query(query, db)
    print 'The new checksum is: ', checksum_new




